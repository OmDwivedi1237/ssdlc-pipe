(()=>{var e={};e.id=30,e.ids=[30],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5138:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>k,routeModule:()=>_,serverHooks:()=>S,workAsyncStorage:()=>x,workUnitAsyncStorage:()=>E});var a={};r.r(a),r.d(a,{GET:()=>v});var i=r(6559),n=r(8088),s=r(7719),o=r(7501);function c(e){return e.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`)}var l=!1;function p(e,t){l||(o.Ay.init("phc_Bt8GoTBPgkCpDrbaIZzJIEYt0CrJjhBiuLaBck1clce",{api_host:"https://eu.i.posthog.com",distinct_id:e,email:t}),o.Ay.identify(e,{email:t}),l=!0)}async function d(e,t){p(t?.distinct_id,t?.email);let{distinct_id:r,...a}=t||{};o.Ay.capture(e,a)}async function u(e,t){p(t?.distinct_id,t?.email);let{distinct_id:r,...a}=t||{};o.Ay.capture(e,{feature:"main",...a})}var y=null,f=null;async function*m(e=!1){let t=e?y:f;for(t&&t.readyState!==WebSocket.CLOSED||(t=new WebSocket(`ws://localhost:3030/ws/events?images=${e}`),e?y=t:f=t,await new Promise((e,r)=>{t.onopen=e,t.onerror=r}));;){let e=await new Promise(e=>{t.addEventListener("message",t=>e(t))});yield JSON.parse(e.data)}}async function h(e){try{let t=await fetch("http://localhost:3030/experimental/input_control",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:e})});if(!t.ok)throw Error(`http error! status: ${t.status}`);return(await t.json()).success}catch(e){return console.error("failed to control input:",e),!1}}var w=new class{async initAnalyticsIfNeeded(){try{let e=new EventSource("http://localhost:11435/sse/settings"),t=await new Promise((t,r)=>{let a=setTimeout(()=>{e.close(),r(Error("settings stream timeout"))},5e3);e.onmessage=r=>{clearTimeout(a),e.close();let i=JSON.parse(r.data),n=i.find(([e])=>"analyticsEnabled"===e)?.[1]??!1,s=i.find(([e])=>"user.clerk_id"===e)?.[1]??void 0,o=i.find(([e])=>"user.email"===e)?.[1]??void 0;t({analyticsEnabled:n,userId:s,email:o})},e.onerror=t=>{clearTimeout(a),e.close(),r(t)}});return{analyticsEnabled:t.analyticsEnabled,userId:t.userId,email:t.email}}catch(e){return console.error("failed to fetch settings, defaulting to analytics enabled:",e),{analyticsEnabled:!1,userId:void 0}}}async sendDesktopNotification(e){let{userId:t,email:r}=await this.initAnalyticsIfNeeded();try{return await fetch("http://localhost:11435/notify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),await this.captureEvent("notification_sent",{distinct_id:t,email:r,success:!0}),!0}catch{return await this.captureEvent("error_occurred",{feature:"notification",error:"send_failed",distinct_id:t,email:r}),!1}}async queryScreenpipe(e){console.log("queryScreenpipe:",e);let{userId:t,email:r}=await this.initAnalyticsIfNeeded(),a=new URLSearchParams;Object.entries(e).forEach(([e,t])=>{if(void 0!==t&&""!==t){if("speakerIds"===e&&Array.isArray(t))t.length>0&&a.append(c(e),t.join(","));else{let r=c(e);a.append(r,t.toString())}}});let i=`http://localhost:3030/search?${a}`;try{let a=await fetch(i);if(!a.ok){let e=await a.text(),t;try{t=JSON.parse(e),console.error("screenpipe api error:",{status:a.status,error:t})}catch{console.error("screenpipe api error:",{status:a.status,error:e})}throw Error(`http error! status: ${a.status}`)}let n=await a.json();return await d("search_performed",{distinct_id:t,content_type:e.contentType,result_count:n.pagination.total,email:r}),function e(t){return Array.isArray(t)?t.map(e):null!==t&&"object"==typeof t?Object.keys(t).reduce((r,a)=>(r[a.replace(/([-_][a-z])/g,e=>e.toUpperCase().replace("-","").replace("_",""))]=e(t[a]),r),{}):t}(n)}catch(e){return await d("error_occurred",{feature:"search",error:"query_failed",distinct_id:t,email:r}),console.error("error querying screenpipe:",e),null}}input={type:e=>h({type:"WriteText",data:e}),press:e=>h({type:"KeyPress",data:e}),moveMouse:(e,t)=>h({type:"MouseMove",data:{x:e,y:t}}),click:e=>h({type:"MouseClick",data:e})};async *streamTranscriptions(){try{for(;;)for await(let e of m())if("transcription"===e.name){let t=e.data;yield{id:crypto.randomUUID(),object:"text_completion_chunk",created:Date.now(),model:"screenpipe-realtime",choices:[{text:t.transcription,index:0,finish_reason:t.is_final?"stop":null}],metadata:{timestamp:t.timestamp,device:t.device,isInput:t.is_input}}}}catch(e){console.error("error streaming transcriptions:",e)}}async *streamVision(e=!1){try{for await(let t of m(e))if("ocr_result"===t.name||"ui_frame"===t.name){let e=t.data;yield{type:t.name,data:e}}}catch(e){console.error("error streaming vision:",e)}}async captureEvent(e,t){let{analyticsEnabled:r}=await this.initAnalyticsIfNeeded();if(r)return d(e,t)}async captureMainFeatureEvent(e,t){let{analyticsEnabled:r}=await this.initAnalyticsIfNeeded();if(r)return u(e,t)}async *streamEvents(e=!1){for await(let t of m(e))yield t}};let g=async(e=60)=>{let t=[],r=Date.now();try{for await(let a of w.streamVision(!0)){if(Date.now()-r>1e3*e)break;a.data&&a.data.text?t.push(a.data.text):console.warn("Received event without OCR text:",a)}return t.join("\n")}catch(e){throw console.error("Failed to capture screen data:",e),Error("Screen capture failed")}};async function v(e){let t="true"===new URL(e.url).searchParams.get("withOcr");try{let e=await g(60*!!t);if(!e)return new Response(JSON.stringify({error:"No screen data captured"}),{status:500});return new Response(JSON.stringify({eventData:e}),{status:200})}catch(e){return console.error("Error capturing screen data:",e),new Response(JSON.stringify({error:"Failed to capture screen data"}),{status:500})}}let _=new i.AppRouteRouteModule({definition:{kind:n.RouteKind.APP_ROUTE,page:"/api/screenpipe/route",pathname:"/api/screenpipe",filename:"route",bundlePath:"app/api/screenpipe/route"},resolvedPagePath:"C:\\Users\\26dwi\\ssdlc-pipe\\app\\api\\screenpipe\\route.ts",nextConfigOutput:"",userland:a}),{workAsyncStorage:x,workUnitAsyncStorage:E,serverHooks:S}=_;function k(){return(0,s.patchFetch)({workAsyncStorage:x,workUnitAsyncStorage:E})}},6487:()=>{},6559:(e,t,r)=>{"use strict";e.exports=r(4870)},8335:()=>{},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[719,501],()=>r(5138));module.exports=a})();